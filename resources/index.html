<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>General info - MEV REST API</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../css/theme.css" />
  <link rel="stylesheet" href="../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
  <link href="../style.css" rel="stylesheet" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "General info";
    var mkdocs_page_input_path = "resources.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> MEV REST API</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Setup</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../install/">Installation</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../setup_configuration/">Configuration</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">API</span></p>
                <ul class="current">
                    <li class="toctree-l1"><a class="reference internal" href="../api/">Intro</a>
                    </li>
                    <li class="toctree-l1 current"><a class="reference internal current" href="#">Data Structures</a>
    <ul class="current">
                <li class="toctree-l2"><a class="reference internal" href="../attributes/">Attributes</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../elements/">Observations and Features</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../workspaces/">Workspaces</a>
                </li>
                <li class="toctree-l2 current"><a class="reference internal current" href="#">Resources</a>
    <ul class="current">
                <li class="toctree-l3 current"><a class="reference internal current" href="./">General info</a>
    <ul class="current">
    </ul>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../resource_types/">Resource types</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../resource_metadata/">Resource metadata</a>
                </li>
    </ul>
                </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../auth/">Authentication</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../operations/">Operations</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../example_workflow/">Workflow and analysis concepts</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">MEV REST API</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
        
          <li>Resources &raquo;</li>
        
      
        
          <li>Data Structures &raquo;</li>
        
      
        
          <li>API &raquo;</li>
        
      
    
    <li>General info</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/web-mev/mev-backend/edit/master/docs/resources.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h3 id="resources"><a class="toclink" href="#resources">Resources</a></h3>
<p>Much of the information regarding <code>Resource</code> instances is provided in the auto-generated docstring below, but here we highlight some key elements of the <code>Resource</code> model.  Namely, the kinds of operations users and admins can take to create, delete, or otherwise manipulated <code>Resource</code>s via the API.</p>
<p><strong>Resource creation</strong></p>
<ul>
<li>
<p>Regular MEV users can only create <code>Resource</code> instances by uploading files, either via a direct method (upload from local machine) or by using one our cloud-based uploaders. They can't do this via the API.</p>
</li>
<li>
<p>Admins can "override" and create <code>Resource</code> instances manually via the API.</p>
</li>
<li>
<p>Regardless of who created the <code>Resource</code>, the validation process is started asynchronously.  We cannot assume that the files are properly validated, even if the request was initiated by an admin.</p>
</li>
<li>
<p>Upon creation of the <code>Resource</code>, it is immediately set to "inactive" (<code>is_active = False</code>) while we validate the particular type.</p>
</li>
<li>
<p><code>Resource</code> instances have a single owner, which is the owner who uploaded the file, or directly specified by the admin in the API request.</p>
</li>
</ul>
<p><strong>Resource "type"</strong></p>
<ul>
<li>
<p>A <code>Resource</code> is required to have a "type" (e.g. an integer matrix) which we call a <code>resource_type</code>.  These types are restricted to a set of common file formats.  Upon creation, <code>resource_type</code> is set to <code>None</code> which indicates that the <code>Resource</code> has not been validated.</p>
</li>
<li>
<p>The type of the <code>Resource</code> can be specified when the file is uploaded or at any other time (i.e. users can change the type if they desire).  Each request to change type initiates an asynchronous validation process.</p>
</li>
<li>
<p>If the validation of the <code>resource_type</code> fails, we revert back to the previous successfully validated type.  If the type was previously <code>None</code> (as with a new upload), we simply revert back to <code>None</code> and inform the user the validation failed.</p>
</li>
</ul>
<p><strong>Resources and Workspaces</strong></p>
<ul>
<li>
<p><code>Resource</code> instances are initially "unattached" meaning they are associated with their owner, but have <em>not</em> been associated with any user workspaces.  Admins can, however, specify a <code>Workspace</code> in their request to create the <code>Resource</code> directly via the API.</p>
</li>
<li>
<p>When a user chooses to "add" a <code>Resource</code> to a <code>Workspace</code>, a new database record is created which is a copy of the original, unattached <code>Resource</code> with the same attributes <em>except</em> the unique <code>Resource</code> UUID.  Thus, we have two database records referencing the same file.
We could accomplish something similar with a many-to-one mapping of <code>Workspace</code> to <code>Resource</code>s, but this was a choice we made which could allow for resource-copying if we ever allow file-editing in the future.  In that case, attaching a <code>Resource</code> to a <code>Workspace</code> could create a copy of the file such that the original <code>Resource</code> remains unaltered.
The user can, of course, change any of the <em>mutable</em> members of this new <code>Workspace</code>-associated <code>Resource</code>.  The changes will be independent of the original "unattached" <code>Resource</code>.</p>
</li>
<li>
<p>Users can remove a <code>Resource</code> from a <code>Workspace</code> if it has NOT been used for any portions of the analysis.  We want to retain the completeness of the analysis, so deleting files that are part of the analysis "tree" would create gaps. </p>
</li>
</ul>
<p><strong>Deletion of Resources</strong></p>
<p>Since multiple database records can reference the same underlying file, we have a bit of custom logic for determining when we delete only the database record versus deleting the actual underlying file.  Essentially, if a deletion is requested and no other <code>Resource</code> database records reference the same file, then we delete <em>both</em> the database record AND the file.  In the case where there is another database record referencing that file, we only remove the database record, leaving the file.</p>
<p><strong>Notes related to backend implementation</strong></p>
<ul>
<li>
<p>In general, the <code>is_active = False</code> flag disallows any updating of the <code>Resource</code> attributes via the API.  All post/patch/put requests will return a 400 status.  This prevents multiple requests from interfering with an ongoing background process.</p>
</li>
<li>
<p>Users cannot change the <code>path</code> member.  The actual storage of the files should not matter to the users so they are unable to change the <code>path</code> member.</p>
</li>
</ul>
<div class="autodoc">
<div class="autodoc-signature"><em>class </em><code>api.models.resource.<strong>Resource</strong></code><span class="autodoc-punctuation">(</span><em class="autodoc-param">*args</em><span class="autodoc-punctuation">, </span><em class="autodoc-param">**kwargs</em><span class="autodoc-punctuation">)</span></div>
<div class="autodoc-docstring"><p>A <code>Resource</code> is an abstraction of data.  It represents some
piece of data we are analyzing or manipulating in the course of
an analysis workflow.</p>
<p><code>Resource</code>s are most often represented by flat files, but their
physical storage is not important.  They could be stored locally
or in cloud storage accessible to MEV.</p>
<p>Various "types" of <code>Resource</code>s implement specific constraints
on the data that are important for tracking inputs and outputs of
analyses.  For example, if an analysis module needs to operate on
a matrix of integers, we can enforce that the only <code>Resource</code>s
available as inputs are those identified (and verified) as
<code>IntegerMatrix</code> "types".</p>
<p>Note that we store all types of <code>Resource</code>s in the database as
a single table and maintain the notion of "type" by a
string-field identifier.  Creating specific database tables for
each type of <code>Resource</code> would be unnecessary.  By connecting the
string stored in the database with a concrete implementation class
we can check the type of the <code>Resource</code>.</p>
<p><code>Resource</code>s are not active (<code>is_active</code> flag in the database) until their "type"
has been verified.  API users will submit the intended type with
the request and the backend will check that.  Violations are
reported and the <code>Resource</code> remains inactive (<code>is_active=False</code>).</p>
<p>Some additional notes:</p>
<ul>
<li>
<p><code>Resource</code>s are owned by users and <em>can</em> be added to a <code>Workspace</code>.
However, that is not required-- <code>Resource</code>s can be "unattached".</p>
</li>
<li>
<p>Regular users (non-admins) can't create new <code>Resource</code> directly via the API.
The only way they can create a <code>Resource</code> is indirectly by adding a new upload.</p>
</li>
<li>
<p>When a <code>Resource</code> is added to a <code>Workspace</code>, a new copy of the database
record is made.  This maintains the state of the original <code>Resource</code>.</p>
</li>
<li>
<p><code>Resource</code>s can be made "public" so that others can view and import
them.  Once another user chooses to import the file, a copy is made and
that new user has their own copy.  If a <code>Resource</code> is later made "private"
then any files that have been "used" by others <em>cannot</em> be recalled.</p>
</li>
<li>
<p><code>Resource</code>s can be removed from a <code>Workspace</code>, but only if they have not
been used for any analyses/operations.</p>
</li>
<li>
<p><code>Resource</code>s cannot be transferred from one <code>Workspace</code> to another, but
they can be copied.</p>
</li>
<li>
<p>A change in the type of the <code>Resource</code> can be requested.  Until the
validation of that change is complete, the <code>Resource</code> is made private and
inactive.</p>
</li>
<li>
<p>Admins can make essentially any change to <code>Resources</code>, including creation.
However, they must be careful to maintain the integrity of the database
and the files they point to.</p>
</li>
<li>
<p>In a request to create a <code>Resource</code> via the API, the <code>resource_type</code>
field can be blank/null.  The type can be inferred from the path of the
resource.  We can do this because only admins are allowed to create via the API
and they should only generate such requests if the resource type can be
inferred (i.e. admins know not to give bad requests to the API...)</p>
</li>
</ul></div>
</div>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../resource_types/" class="btn btn-neutral float-right" title="Resource types">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../workspaces/" class="btn btn-neutral" title="Workspaces"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/web-mev/mev-backend/" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../workspaces/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../resource_types/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
